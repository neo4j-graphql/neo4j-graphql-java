// This file was generated by the Test-Case extractor of neo4j-graphql
:toc:
:toclevels: 42

= https://github.com/neo4j/graphql/issues/1686

== Setup

.Schema
[source,graphql,schema=true]
----
interface Production {
  id: ID
  title: String
}

type Movie implements Production {
  id: ID
  title: String
  genres: [Genre!]! @relationship(type: "HAS_GENRE", direction: OUT)
}

type Genre {
  name: String
  movies: [Production!]! @relationship(type: "HAS_GENRE", direction: IN)
}
----

== should be possible to count all the movies connections

.Test Data
[source,cypher,test-data=true]
----
CREATE (c:Movie { id: "1", title: "Matrix" })-[:HAS_GENRE]->(:Genre { id: "10", name: "Sci-fi" })
 CREATE (c)-[:HAS_GENRE]->(g2:Genre { id: "11", name: "Action" })
 CREATE (h:Movie { id: "2", title: "The Hobbit" })-[:HAS_GENRE]->(g3:Genre { id: "12", name: "Fantasy" })
----

.GraphQL-Query
[source,graphql,request=true]
----
query MoviesConnection {
  moviesConnection {
    totalCount
  }
}
----

.Expected Cypher params
[source,json]
----
{}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this0:Movie)
WITH collect({ node: this0 }) AS edges
WITH edges, size(edges) AS totalCount
CALL {
    WITH edges
    UNWIND edges AS edge
    WITH edge.node AS this0
    RETURN collect({ node: { __id: toString(id(this0)), __typename: "Movie" } }) AS var1
}
RETURN { edges: var1, totalCount: totalCount } AS this
----

.GraphQL-Response
[source,json,response=true]
----
{
  "moviesConnection": {
    "totalCount": 2
  }
}
----
