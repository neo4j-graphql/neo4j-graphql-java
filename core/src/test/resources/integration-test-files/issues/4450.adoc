:toc:
:toclevels: 42

= https://github.com/neo4j/graphql/issues/4450

== Setup

.Schema
[source,graphql,schema=true]
----
type Actor {
  name: String
  scene: [Scene!]! @relationship(type: "IN_SCENE", properties: "ActorScene", direction: OUT)
}

type Scene {
  number: Int
  actors: [Actor!]! @relationship(type: "IN_SCENE", properties: "ActorScene", direction: IN)
  location: Location! @relationship(type: "AT_LOCATION", direction: OUT)
}

type Location {
  city: String
  scenes: [Scene!]! @relationship(type: "AT_LOCATION", direction: IN)
}

type ActorScene @relationshipProperties {
  cut: Boolean
}
----

.Test Data
[source,cypher,test-data=true]
----
CREATE (:Actor {name: "actor-1"})-[:IN_SCENE {cut: true}]->(:Scene {number: 1})-[:AT_LOCATION]->(:Location {city: "test"})
----

== filtering through a connection to a many-to-1 relationship should work

.GraphQL-Query
[source,graphql]
----
{
  actors(
    where: {sceneConnection_SOME: {edge: {cut: true}, node: {location: {city: "test"}}}}
  ) {
    name
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0": "test",
  "param1": true
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:Actor)
WHERE EXISTS {
	MATCH (this)-[edge:IN_SCENE]->(this0:Scene)
	WHERE (EXISTS {
			MATCH (this0)-[:AT_LOCATION]->(this00:Location)
			WHERE this00.city = $param0
		}
		AND edge.cut = $param1)
}
RETURN this {
	.name
} AS this
----

.GraphQL-Response
[source,json,response=true]
----
{
  "actors": [
    {
      "name": "actor-1"
    }
  ]
}
----

'''

