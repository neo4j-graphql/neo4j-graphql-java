// This file was generated by the Test-Case extractor of neo4j-graphql
:toc:
:toclevels: 42

= 587: Dates in edges can cause wrongly generated cypher

== should not throw when returning a date in an edge

.Schema
[source,graphql,schema=true]
----
type Genre {
  id: ID!
  movies: [Movie!]! @relationship(type: "MOVIE", direction: OUT)
}

type Movie {
  title: String!
  actors: [Actor!]! @relationship(type: "ACTOR", direction: OUT)
}

type Actor {
  name: String!
  birthday: DateTime!
  movie: Movie! @relationship(type: "ACTOR", direction: IN)
}
----

.Test Data
[source,cypher,test-data=true]
----
CREATE (genre:Genre { id: "RandomString1" })
 CREATE (movie:Movie { title: "RandomString2" })
 CREATE (actor:Actor { name: "RandomString3", birthday: datetime("2021-11-16T10:53:20.200000000Z")})
 CREATE (genre)-[:Movie]->(movie)-[:Actor { role: "Name" }]->(actor)
 RETURN actor
----

.GraphQL-Query
[source,graphql,request=true]
----
{
  genres(where: {id: "RandomString1"}) {
    movies {
      actorsConnection {
        edges {
          node {
            birthday
          }
        }
      }
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0": "RandomString1"
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:Genre)
WHERE this.id = $param0
CALL {
    WITH this
    MATCH (this)-[this0:MOVIE]->(this1:Movie)
    CALL {
        WITH this1
        MATCH (this1)-[this2:ACTOR]->(this3:Actor)
        WITH collect({ node: this3, relationship: this2 }) AS edges
        WITH edges, size(edges) AS totalCount
        CALL {
            WITH edges
            UNWIND edges AS edge
            WITH edge.node AS this3, edge.relationship AS this2
            RETURN collect({ node: { birthday: apoc.date.convertFormat(toString(this3.birthday), "iso_zoned_date_time", "iso_offset_date_time"), __typename: "Actor" } }) AS var4
        }
        RETURN { edges: var4, totalCount: totalCount } AS var5
    }
    WITH this1 { actorsConnection: var5 } AS this1
    RETURN collect(this1) AS var6
}
RETURN this { movies: var6 } AS this
----

.GraphQL-Response
[source,json,response=true]
----
{
  "genres": [
    {
      "movies": []
    }
  ]
}
----
