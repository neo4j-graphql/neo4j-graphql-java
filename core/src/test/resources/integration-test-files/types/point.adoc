:toc:
:toclevels: 42

= Point

== Setup

.Schema
[source,graphql,schema=true]
----
type Photograph {
  id: String!
  size: Int!
  location: Point!
}

type Query {
  custom: String!
}
----

== enables query for equality of a node with a wgs-84-3d point

.Test Data
[source,cypher,test-data=true]
----
CALL {
 CREATE (p:Photograph)
 SET p.id = "3019fe82-5231-4103-8662-39c1fcc7d50c"
 SET p.size = 99119
 SET p.location = point({longitude: 125.6358, latitude: -7.2045, height: 0.6950517320074141})
 RETURN p
 }

 RETURN p { .id, .size, .location } AS p
----

.GraphQL-Query
[source,graphql,request=true]
----
query Photographs($longitude: Float!, $latitude: Float!, $height: Float) {
  photographs(
    where: {location: {longitude: $longitude, latitude: $latitude, height: $height}}
  ) {
    id
    size
    location {
      latitude
      longitude
      height
      crs
    }
  }
}
----

.GraphQL params input
[source,json,request=true]
----
{
  "height" : 0.6950517320074141,
  "latitude" : -7.2045,
  "longitude" : 125.6358
}
----

.Expected Cypher params
[source,json]
----
{
  "param0" : {
    "longitude" : 125.6358,
    "latitude" : -7.2045,
    "height" : 0.6950517320074141
  }
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:Photograph)
WHERE this.location = point($param0)
RETURN this {
	.id,
	.size,
	location: CASE WHEN this.location IS NOT NULL THEN {
		latitude: this.location.latitude,
		longitude: this.location.longitude,
		height: CASE WHEN this.location.srid = 4979 THEN this.location.height ELSE NULL END,
		crs: this.location.crs
	} ELSE NULL END
} AS this
----

.GraphQL-Response
[source,json,response=true]
----
{
  "photographs" : [ {
    "id" : "3019fe82-5231-4103-8662-39c1fcc7d50c",
    "size" : 99119,
    "location" : {
      "latitude" : -7.2045,
      "longitude" : 125.6358,
      "height" : 0.6950517320074141,
      "crs" : "wgs-84-3d"
    }
  } ]
}
----
