:toc:
:toclevels: 42

= [CartesianPoint]

== Setup

.Schema
[source,graphql,schema=true]
----
type Part {
  id: String!
  locations: [CartesianPoint!]!
}
----

== enables query of a node with multiple cartesian points

.Test Data
[source,cypher,test-data=true]
----
CALL {
 CREATE (r:Part)
 SET r.id = "5ba92bc4-95e7-4361-857c-60edcd771391"
 SET r.locations = [p in [{x: 0.02772025833837688, y: 0.07264417805708945}, {x: 0.02772025833837688, y: 0.07264417805708945}, {x: 0.02772025833837688, y: 0.07264417805708945}, {x: 0.02772025833837688, y: 0.07264417805708945}, {x: 0.02772025833837688, y: 0.07264417805708945}, {x: 0.02772025833837688, y: 0.07264417805708945}, {x: 0.02772025833837688, y: 0.07264417805708945}, {x: 0.02772025833837688, y: 0.07264417805708945}] | point(p)]
 RETURN r
 }

 RETURN r { .id, .locations } AS r
----

.GraphQL-Query
[source,graphql,request=true]
----
query Parts($id: String!) {
  parts(where: {id: $id}) {
    id
    locations {
      y
      x
      z
      crs
    }
  }
}
----

.GraphQL params input
[source,json,request=true]
----
{
  "id" : "5ba92bc4-95e7-4361-857c-60edcd771391"
}
----

.Expected Cypher params
[source,json]
----
{
  "param0" : "5ba92bc4-95e7-4361-857c-60edcd771391"
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:Part)
WHERE this.id = $param0
RETURN this {
	.id,
	locations: CASE WHEN this.locations IS NOT NULL THEN [p_var0 IN this.locations | {
		y: p_var0.y,
		x: p_var0.x,
		z: CASE WHEN p_var0.srid = 9157 THEN p_var0.z ELSE NULL END,
		crs: p_var0.crs
	}] ELSE NULL END
} AS this
----

.GraphQL-Response
[source,json,response=true,ignore-order]
----
{
  "parts" : [ {
    "id" : "5ba92bc4-95e7-4361-857c-60edcd771391",
    "locations" : [ {
      "y" : 0.07264417805708945,
      "x" : 0.02772025833837688,
      "z" : null,
      "crs" : "cartesian"
    }, {
      "y" : 0.07264417805708945,
      "x" : 0.02772025833837688,
      "z" : null,
      "crs" : "cartesian"
    }, {
      "y" : 0.07264417805708945,
      "x" : 0.02772025833837688,
      "z" : null,
      "crs" : "cartesian"
    }, {
      "y" : 0.07264417805708945,
      "x" : 0.02772025833837688,
      "z" : null,
      "crs" : "cartesian"
    }, {
      "y" : 0.07264417805708945,
      "x" : 0.02772025833837688,
      "z" : null,
      "crs" : "cartesian"
    }, {
      "y" : 0.07264417805708945,
      "x" : 0.02772025833837688,
      "z" : null,
      "crs" : "cartesian"
    }, {
      "y" : 0.07264417805708945,
      "x" : 0.02772025833837688,
      "z" : null,
      "crs" : "cartesian"
    }, {
      "y" : 0.07264417805708945,
      "x" : 0.02772025833837688,
      "z" : null,
      "crs" : "cartesian"
    } ]
  } ]
}
----

== enables query of a node with multiple cartesian-3d points

.Test Data
[source,cypher,test-data=true]
----
CALL {
 CREATE (r:Part)
 SET r.id = "052322ec-95e5-4b88-8a90-9f0c1df17ee3"
 SET r.locations = [p in [{x: 0.8367510938551277, y: 0.7110547178890556, z: 0.9648887133225799}, {x: 0.8367510938551277, y: 0.7110547178890556, z: 0.9648887133225799}, {x: 0.8367510938551277, y: 0.7110547178890556, z: 0.9648887133225799}, {x: 0.8367510938551277, y: 0.7110547178890556, z: 0.9648887133225799}, {x: 0.8367510938551277, y: 0.7110547178890556, z: 0.9648887133225799}, {x: 0.8367510938551277, y: 0.7110547178890556, z: 0.9648887133225799}, {x: 0.8367510938551277, y: 0.7110547178890556, z: 0.9648887133225799}, {x: 0.8367510938551277, y: 0.7110547178890556, z: 0.9648887133225799}] | point(p)]
 RETURN r
 }

 RETURN r { .id, .locations } AS r
----

.GraphQL-Query
[source,graphql,request=true]
----
query Parts($id: String!) {
  parts(where: {id: $id}) {
    id
    locations {
      y
      x
      z
      crs
    }
  }
}
----

.GraphQL params input
[source,json,request=true]
----
{
  "id" : "052322ec-95e5-4b88-8a90-9f0c1df17ee3"
}
----

.Expected Cypher params
[source,json]
----
{
  "param0" : "052322ec-95e5-4b88-8a90-9f0c1df17ee3"
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:Part)
WHERE this.id = $param0
RETURN this {
	.id,
	locations: CASE WHEN this.locations IS NOT NULL THEN [p_var0 IN this.locations | {
		y: p_var0.y,
		x: p_var0.x,
		z: CASE WHEN p_var0.srid = 9157 THEN p_var0.z ELSE NULL END,
		crs: p_var0.crs
	}] ELSE NULL END
} AS this
----

.GraphQL-Response
[source,json,response=true,ignore-order]
----
{
  "parts" : [ {
    "id" : "052322ec-95e5-4b88-8a90-9f0c1df17ee3",
    "locations" : [ {
      "y" : 0.7110547178890556,
      "x" : 0.8367510938551277,
      "z" : 0.9648887133225799,
      "crs" : "cartesian-3d"
    }, {
      "y" : 0.7110547178890556,
      "x" : 0.8367510938551277,
      "z" : 0.9648887133225799,
      "crs" : "cartesian-3d"
    }, {
      "y" : 0.7110547178890556,
      "x" : 0.8367510938551277,
      "z" : 0.9648887133225799,
      "crs" : "cartesian-3d"
    }, {
      "y" : 0.7110547178890556,
      "x" : 0.8367510938551277,
      "z" : 0.9648887133225799,
      "crs" : "cartesian-3d"
    }, {
      "y" : 0.7110547178890556,
      "x" : 0.8367510938551277,
      "z" : 0.9648887133225799,
      "crs" : "cartesian-3d"
    }, {
      "y" : 0.7110547178890556,
      "x" : 0.8367510938551277,
      "z" : 0.9648887133225799,
      "crs" : "cartesian-3d"
    }, {
      "y" : 0.7110547178890556,
      "x" : 0.8367510938551277,
      "z" : 0.9648887133225799,
      "crs" : "cartesian-3d"
    }, {
      "y" : 0.7110547178890556,
      "x" : 0.8367510938551277,
      "z" : 0.9648887133225799,
      "crs" : "cartesian-3d"
    } ]
  } ]
}
----
