:toc:

= Cypher Aggregations String

== Source schema

[source,graphql,schema=true]
----
type Movie {
  title: String
  testId: ID
}
----
== Longest

.GraphQL-Query
[source,graphql]
----
{
  moviesAggregate {
    title {
      longest
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{}
----

.Expected Cypher output
[source,cypher]
----
CALL {
    MATCH (this:Movie)
    WITH this
    ORDER BY size(this.title) DESC
    WITH collect(this.title) AS list
    RETURN { longest: head(list) } AS var0
}
RETURN { title: var0 }
----

'''

== Shortest

.GraphQL-Query
[source,graphql]
----
{
  moviesAggregate {
    title {
      shortest
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{}
----

.Expected Cypher output
[source,cypher]
----
CALL {
    MATCH (this:Movie)
    WITH this
    ORDER BY size(this.title) DESC
    WITH collect(this.title) AS list
    RETURN { shortest: last(list) } AS var0
}
RETURN { title: var0 }
----

'''

== Shortest and longest

.GraphQL-Query
[source,graphql]
----
{
  moviesAggregate {
    title {
      shortest
      longest
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{}
----

.Expected Cypher output
[source,cypher]
----
CALL {
    MATCH (this:Movie)
    WITH this
    ORDER BY size(this.title) DESC
    WITH collect(this.title) AS list
    RETURN { longest: head(list), shortest: last(list) } AS var0
}
RETURN { title: var0 }
----

'''

== Shortest with filter

.GraphQL-Query
[source,graphql]
----
{
  moviesAggregate(where: {testId: "10"}) {
    title {
      shortest
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0": "10"
}
----

.Expected Cypher output
[source,cypher]
----
CALL {
    MATCH (this:Movie)
    WHERE this.testId = $param0
    WITH this
    ORDER BY size(this.title) DESC
    WITH collect(this.title) AS list
    RETURN { shortest: last(list) } AS var0
}
RETURN { title: var0 }
----

'''

