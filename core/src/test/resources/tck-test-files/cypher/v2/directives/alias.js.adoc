// This file was generated by the Test-Case extractor of neo4j-graphql
:toc:
:toclevels: 42

= Cypher alias directive

== Setup

.Schema
[source,graphql,schema=true]
----
type Actor {
  name: String!
  city: String @alias(property: "cityPropInDb")
  actedIn: [Movie!]! @relationship(direction: OUT, type: "ACTED_IN", properties: "ActorActedInProps")
}

type Movie {
  title: String!
  rating: Float @alias(property: "ratingPropInDb")
}

type ActorActedInProps @relationshipProperties {
  character: String! @alias(property: "characterPropInDb")
  screenTime: Int
}
----

== Simple relation

.GraphQL-Query
[source,graphql,request=true]
----
{
  actors {
    name
    city
    actedIn {
      title
      rating
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:Actor)
CALL {
    WITH this
    MATCH (this)-[this0:ACTED_IN]->(this1:Movie)
    WITH this1 { .title, rating: this1.ratingPropInDb } AS this1
    RETURN collect(this1) AS var2
}
RETURN this { .name, city: this.cityPropInDb, actedIn: var2 } AS this
----

== With relationship properties

.GraphQL-Query
[source,graphql,request=true]
----
{
  actors {
    name
    city
    actedInConnection {
      edges {
        properties {
          character
          screenTime
        }
        node {
          title
          rating
        }
      }
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:Actor)
CALL {
    WITH this
    MATCH (this)-[this0:ACTED_IN]->(this1:Movie)
    WITH collect({ node: this1, relationship: this0 }) AS edges
    WITH edges, size(edges) AS totalCount
    CALL {
        WITH edges
        UNWIND edges AS edge
        WITH edge.node AS this1, edge.relationship AS this0
        RETURN collect({ properties: { character: this0.characterPropInDb, screenTime: this0.screenTime, __typename: "ActorActedInProps" }, node: { title: this1.title, rating: this1.ratingPropInDb, __typename: "Movie" } }) AS var2
    }
    RETURN { edges: var2, totalCount: totalCount } AS var3
}
RETURN this { .name, city: this.cityPropInDb, actedInConnection: var3 } AS this
----
