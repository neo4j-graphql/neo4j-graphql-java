:toc:

= Cypher coalesce()

== Source schema

[source,graphql,schema=true]
----
interface UserInterface {
  fromInterface: String!
  toBeOverridden: String!
}

type User implements UserInterface {
  id: ID! @coalesce(value: "00000000-00000000-00000000-00000000")
  name: String! @coalesce(value: "Jane Smith")
  verified: Boolean! @coalesce(value: false)
  numberOfFriends: Int! @coalesce(value: 0)
  rating: Float! @coalesce(value: 2.5)
  fromInterface: String!
  toBeOverridden: String! @coalesce(value: "Overridden")
}
----

== Configuration

.Configuration
[source,json,schema-config=true]
----
{
  "features": {
    "filters": {
      "String": {
        "MATCHES": true
      }
    }
  }
}
----
== Simple coalesce

.GraphQL-Query
[source,graphql]
----
query ($id: ID, $name: String, $verified: Boolean, $numberOfFriends: Int, $rating: Float, $fromInterface: String, $toBeOverridden: String) {
  users(
    where: {id: $id, name_MATCHES: $name, NOT: {verified: $verified}, numberOfFriends_GT: $numberOfFriends, rating_LT: $rating, fromInterface: $fromInterface, toBeOverridden: $toBeOverridden}
  ) {
    name
  }
}
----

.GraphQL params input
[source,json,request=true]
----
{
  "id": "Some ID",
  "name": "Some name",
  "verified": true,
  "numberOfFriends": 10,
  "rating": 3.5,
  "fromInterface": "Some string",
  "toBeOverridden": "Some string"
}
----

.Expected Cypher params
[source,json]
----
{
  "param0": "Some ID",
  "param1": "Some name",
  "param2": 10,
  "param3": 3.5,
  "param4": "Some string",
  "param5": "Some string",
  "param6": true
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:User)
WHERE (coalesce(this.id, "00000000-00000000-00000000-00000000") = $param0 AND coalesce(this.name, "Jane Smith") =~ $param1 AND coalesce(this.numberOfFriends, 0) > $param2 AND coalesce(this.rating, 2.5) < $param3 AND this.fromInterface = $param4 AND coalesce(this.toBeOverridden, "Overridden") = $param5 AND NOT (coalesce(this.verified, false) = $param6))
RETURN this { .name } AS this
----

'''

