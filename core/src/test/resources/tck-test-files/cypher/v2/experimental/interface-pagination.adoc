:toc:

= Top-level Interface query pagination (sort and limit)

== Source schema

[source,graphql,schema=true]
----
type SomeNodeType implements MyOtherInterface & MyInterface {
  id: ID! @id @unique
  something: String
  somethingElse: String
  other: [OtherNodeType!]! @relationship(type: "HAS_OTHER_NODES", direction: OUT)
}

type OtherNodeType {
  id: ID! @id @unique
  interfaceField: MyInterface! @relationship(type: "HAS_INTERFACE_NODES", direction: OUT)
}

interface MyInterface {
  id: ID!
}

interface MyOtherInterface implements MyInterface {
  id: ID!
  something: String
}

type MyImplementationType implements MyInterface {
  id: ID! @id @unique
}

type MyOtherImplementationType implements MyInterface {
  id: ID! @id @unique
  someField: String
}
----

== Configuration

.Configuration
[source,json,schema-config=true]
----
{
  "experimental": true
}
----

== Sort on Interface top-level

.GraphQL-Query
[source,graphql]
----
{
  myInterfaces(options: {sort: [{id: ASC}], limit: 10}) {
    id
    ... on MyOtherImplementationType {
      someField
    }
    ... on MyOtherInterface {
      something
      ... on SomeNodeType {
        somethingElse
        other {
          id
        }
      }
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0" : 10
}
----

.Expected Cypher output
[source,cypher]
----
CALL {
	MATCH (this0:SomeNodeType)
	CALL {
		WITH this0
		MATCH (this0)-[this1:HAS_OTHER_NODES]->(this2:OtherNodeType)
		WITH this2 {
			.id
		} AS this2
		RETURN collect(this2) AS var3
	}
	WITH this0 {
		.id,
		.something,
		.somethingElse,
		other: var3,
		__resolveType: 'SomeNodeType',
		__id: id(this0)
	} AS this0
	RETURN this0 AS this UNION
	MATCH (this4:MyImplementationType)
	WITH this4 {
		.id,
		__resolveType: 'MyImplementationType',
		__id: id(this4)
	} AS this4
	RETURN this4 AS this UNION
	MATCH (this5:MyOtherImplementationType)
	WITH this5 {
		.id,
		.someField,
		__resolveType: 'MyOtherImplementationType',
		__id: id(this5)
	} AS this5
	RETURN this5 AS this
}
WITH this ORDER BY this.id ASC LIMIT $param0
RETURN this AS this
----

'''

== Sort on Interface top-level without projecting the sorted field

.GraphQL-Query
[source,graphql]
----
{
  myInterfaces(options: {sort: [{id: ASC}], limit: 10}) {
    ... on MyOtherImplementationType {
      someField
    }
    ... on MyOtherInterface {
      something
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0" : 10
}
----

.Expected Cypher output
[source,cypher]
----
CALL {
	MATCH (this0:SomeNodeType)
	WITH this0 {
		.something,
		.id,
		__resolveType: 'SomeNodeType',
		__id: id(this0)
	} AS this0
	RETURN this0 AS this UNION
	MATCH (this1:MyImplementationType)
	WITH this1 {
		.id,
		__resolveType: 'MyImplementationType',
		__id: id(this1)
	} AS this1
	RETURN this1 AS this UNION
	MATCH (this2:MyOtherImplementationType)
	WITH this2 {
		.someField,
		.id,
		__resolveType: 'MyOtherImplementationType',
		__id: id(this2)
	} AS this2
	RETURN this2 AS this
}
WITH this ORDER BY this.id ASC LIMIT $param0
RETURN this AS this
----

'''

== Sort on Interfaces top-level + nested

.GraphQL-Query
[source,graphql]
----
{
  myInterfaces(options: {sort: [{id: ASC}], limit: 10}) {
    id
    ... on MyOtherImplementationType {
      someField
    }
    ... on MyOtherInterface {
      something
      ... on SomeNodeType {
        somethingElse
        other(options: {sort: [{id: DESC}], limit: 2}) {
          id
        }
      }
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0" : 2,
  "param1" : 10
}
----

.Expected Cypher output
[source,cypher]
----
CALL {
	MATCH (this0:SomeNodeType)
	CALL {
		WITH this0
		MATCH (this0)-[this1:HAS_OTHER_NODES]->(this2:OtherNodeType)
		WITH this2 {
			.id
		} AS this2 ORDER BY this2.id DESC LIMIT $param0
		RETURN collect(this2) AS var3
	}
	WITH this0 {
		.id,
		.something,
		.somethingElse,
		other: var3,
		__resolveType: 'SomeNodeType',
		__id: id(this0)
	} AS this0
	RETURN this0 AS this UNION
	MATCH (this4:MyImplementationType)
	WITH this4 {
		.id,
		__resolveType: 'MyImplementationType',
		__id: id(this4)
	} AS this4
	RETURN this4 AS this UNION
	MATCH (this5:MyOtherImplementationType)
	WITH this5 {
		.id,
		.someField,
		__resolveType: 'MyOtherImplementationType',
		__id: id(this5)
	} AS this5
	RETURN this5 AS this
}
WITH this ORDER BY this.id ASC LIMIT $param1
RETURN this AS this
----

'''

