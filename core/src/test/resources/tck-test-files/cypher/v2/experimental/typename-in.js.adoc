// This file was generated by the Test-Case extractor of neo4j-graphql
:toc:
:toclevels: 42

= typename_IN

== Setup

.Schema
[source,graphql,schema=true]
----
interface Production {
  title: String!
  cost: Float!
}

type Movie implements Production {
  title: String!
  cost: Float!
  runtime: Int!
}

type Series implements Production {
  title: String!
  cost: Float!
  episodes: Int!
}

type Cartoon implements Production {
  title: String!
  cost: Float!
  cartoonist: String!
}

type ActedIn @relationshipProperties {
  screenTime: Int!
}

type Actor {
  name: String!
  actedIn: [Production!]! @relationship(type: "ACTED_IN", direction: OUT, properties: "ActedIn")
}
----

== top-level

.GraphQL-Query
[source,graphql,request=true]
----
{
  productions(
    where: {OR: [{AND: [{title: "The Matrix"}, {typename_IN: [Series]}]}, {typename_IN: [Movie]}]}
  ) {
    title
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0": "The Matrix",
  "param1": "The Matrix",
  "param2": "The Matrix"
}
----

.Expected Cypher output
[source,cypher]
----
CALL {
    MATCH (this0:Cartoon)
    WHERE ((this0.title = $param0 AND this0:Series) OR this0:Movie)
    WITH this0 { .title, __typename: "Cartoon", __id: toString(id(this0)) } AS this0
    RETURN this0 AS this
    UNION
    MATCH (this1:Movie)
    WHERE ((this1.title = $param1 AND this1:Series) OR this1:Movie)
    WITH this1 { .title, __typename: "Movie", __id: toString(id(this1)) } AS this1
    RETURN this1 AS this
    UNION
    MATCH (this2:Series)
    WHERE ((this2.title = $param2 AND this2:Series) OR this2:Movie)
    WITH this2 { .title, __typename: "Series", __id: toString(id(this2)) } AS this2
    RETURN this2 AS this
}
WITH this
RETURN this AS this
----

== top-level + connection where

.GraphQL-Query
[source,graphql,request=true]
----
{
  actors(
    where: {actedInConnection_SOME: {OR: [{edge: {screenTime: 2}}, {node: {OR: [{title: "The Matrix"}, {typename_IN: [Series]}]}}]}}
  ) {
    actedIn {
      title
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0": 2,
  "param1": "The Matrix"
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:Actor)
WHERE EXISTS {
    MATCH (this)-[this0:ACTED_IN]->(this1)
    WHERE ((this0.screenTime = $param0 OR (this1.title = $param1 OR this1:Series)) AND (this1:Cartoon OR this1:Movie OR this1:Series))
}
CALL {
    WITH this
    CALL {
        WITH *
        MATCH (this)-[this2:ACTED_IN]->(this3:Cartoon)
        WITH this3 { .title, __typename: "Cartoon", __id: toString(id(this3)) } AS this3
        RETURN this3 AS var4
        UNION
        WITH *
        MATCH (this)-[this5:ACTED_IN]->(this6:Movie)
        WITH this6 { .title, __typename: "Movie", __id: toString(id(this6)) } AS this6
        RETURN this6 AS var4
        UNION
        WITH *
        MATCH (this)-[this7:ACTED_IN]->(this8:Series)
        WITH this8 { .title, __typename: "Series", __id: toString(id(this8)) } AS this8
        RETURN this8 AS var4
    }
    WITH var4
    RETURN collect(var4) AS var4
}
RETURN this { actedIn: var4 } AS this
----

== nested

.GraphQL-Query
[source,graphql,request=true]
----
{
  actors {
    actedIn(
      where: {OR: [{AND: [{title: "The Matrix"}, {typename_IN: [Series]}]}, {typename_IN: [Movie]}]}
    ) {
      title
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0": "The Matrix",
  "param1": "The Matrix",
  "param2": "The Matrix"
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:Actor)
CALL {
    WITH this
    CALL {
        WITH *
        MATCH (this)-[this0:ACTED_IN]->(this1:Cartoon)
        WHERE ((this1.title = $param0 AND this1:Series) OR this1:Movie)
        WITH this1 { .title, __typename: "Cartoon", __id: toString(id(this1)) } AS this1
        RETURN this1 AS var2
        UNION
        WITH *
        MATCH (this)-[this3:ACTED_IN]->(this4:Movie)
        WHERE ((this4.title = $param1 AND this4:Series) OR this4:Movie)
        WITH this4 { .title, __typename: "Movie", __id: toString(id(this4)) } AS this4
        RETURN this4 AS var2
        UNION
        WITH *
        MATCH (this)-[this5:ACTED_IN]->(this6:Series)
        WHERE ((this6.title = $param2 AND this6:Series) OR this6:Movie)
        WITH this6 { .title, __typename: "Series", __id: toString(id(this6)) } AS this6
        RETURN this6 AS var2
    }
    WITH var2
    RETURN collect(var2) AS var2
}
RETURN this { actedIn: var2 } AS this
----
