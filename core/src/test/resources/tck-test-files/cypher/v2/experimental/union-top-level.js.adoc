// This file was generated by the Test-Case extractor of neo4j-graphql
:toc:
:toclevels: 42

= Union top level operations

== Setup

.Schema
[source,graphql,schema=true]
----
union Search = Genre | Movie

type Genre {
  name: String
}

type Movie {
  title: String
  search: [Search!]! @relationship(type: "SEARCH", direction: OUT)
}
----

== Read union

.GraphQL-Query
[source,graphql,request=true]
----
{
  searches {
    ... on Movie {
      title
    }
    ... on Genre {
      name
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{}
----

.Expected Cypher output
[source,cypher]
----
CALL {
    MATCH (this0:Genre)
    WITH this0 { .name, __typename: "Genre", __id: toString(id(this0)) } AS this0
    RETURN this0 AS this
    UNION
    MATCH (this1:Movie)
    WITH this1 { .title, __typename: "Movie", __id: toString(id(this1)) } AS this1
    RETURN this1 AS this
}
WITH this
RETURN this AS this
----

== Read union with relationship on member type

.GraphQL-Query
[source,graphql,request=true]
----
{
  searches {
    ... on Movie {
      title
      search {
        ... on Genre {
          name
        }
      }
    }
    ... on Genre {
      name
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{}
----

.Expected Cypher output
[source,cypher]
----
CALL {
    MATCH (this0:Genre)
    WITH this0 { .name, __typename: "Genre", __id: toString(id(this0)) } AS this0
    RETURN this0 AS this
    UNION
    MATCH (this1:Movie)
    CALL {
        WITH this1
        CALL {
            WITH *
            MATCH (this1)-[this2:SEARCH]->(this3:Genre)
            WITH this3 { .name, __typename: "Genre", __id: toString(id(this3)) } AS this3
            RETURN this3 AS var4
            UNION
            WITH *
            MATCH (this1)-[this5:SEARCH]->(this6:Movie)
            WITH this6 { __typename: "Movie", __id: toString(id(this6)) } AS this6
            RETURN this6 AS var4
        }
        WITH var4
        RETURN collect(var4) AS var4
    }
    WITH this1 { .title, search: var4, __typename: "Movie", __id: toString(id(this1)) } AS this1
    RETURN this1 AS this
}
WITH this
RETURN this AS this
----
