:toc:

= Cypher -> fulltext -> Additional Labels

== Source schema

[source,graphql,schema=true]
----
type Movie @fulltext(indexes: [{indexName: "MovieTitle", fields: ["title"]}]) @node(labels: ["Movie", "$jwt.label"]) {
  title: String
}
----
== simple match with single fulltext property and jwt additionalLabels

.GraphQL-Query
[source,graphql]
----
{
  movies(fulltext: {MovieTitle: {phrase: "something AND something"}}) {
    title
  }
}
----

.Query Context
[source,json,query-config=true]
----
{
  "auth": {
    "isAuthenticated": true,
    "roles": [],
    "jwt": {
      "roles": [],
      "label": "some-label"
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0": "something AND something",
  "param1": "Movie",
  "param2": "some-label"
}
----

.Expected Cypher output
[source,cypher]
----
CALL db.index.fulltext.queryNodes("MovieTitle", $param0) YIELD node AS this0, score AS var1
WHERE ($param1 IN labels(this0) AND $param2 IN labels(this0))
RETURN this0 { .title } AS this
----

'''

