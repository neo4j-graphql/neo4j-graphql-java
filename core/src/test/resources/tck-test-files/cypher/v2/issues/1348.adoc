:toc:

= https://github.com/neo4j/graphql/issues/1348

== Source schema

[source,graphql,schema=true]
----
interface Product {
  productTitle: String!
  releatsTo: [Product!]!
}

type Series implements Product {
  productTitle: String!
  releatsTo: [Product!]! @relationship(type: "RELATES_TO", direction: OUT, queryDirection: DEFAULT_UNDIRECTED)
  seasons: [Season!]!
}

type Season implements Product {
  productTitle: String!
  releatsTo: [Product!]! @relationship(type: "RELATES_TO", direction: OUT, queryDirection: DEFAULT_UNDIRECTED)
  seasonNumber: Int
  episodes: [ProgrammeItem!]!
}

type ProgrammeItem implements Product {
  productTitle: String!
  releatsTo: [Product!]! @relationship(type: "RELATES_TO", direction: OUT, queryDirection: DEFAULT_UNDIRECTED)
  episodeNumber: Int
}
----
== should also return node with no relationship in result set

.GraphQL-Query
[source,graphql]
----
{
  programmeItems {
    productTitle
    episodeNumber
    releatsTo {
      __typename
      productTitle
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{ }
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:ProgrammeItem)
CALL {
	WITH this
	CALL {
		WITH *
		MATCH (this)-[this0:RELATES_TO]-(this1:Series)
		WITH this1 {
			.productTitle,
			__resolveType: 'Series',
			__id: id(this1)
		} AS this1
		RETURN this1 AS var2 UNION
		WITH *
		MATCH (this)-[this3:RELATES_TO]-(this4:Season)
		WITH this4 {
			.productTitle,
			__resolveType: 'Season',
			__id: id(this4)
		} AS this4
		RETURN this4 AS var2 UNION
		WITH *
		MATCH (this)-[this5:RELATES_TO]-(this6:ProgrammeItem)
		WITH this6 {
			.productTitle,
			__resolveType: 'ProgrammeItem',
			__id: id(this6)
		} AS this6
		RETURN this6 AS var2
	}
	WITH var2
	RETURN collect(var2) AS var2
}
RETURN this {
	.productTitle,
	.episodeNumber,
	releatsTo: var2
} AS this
----

'''

== should return node with no relationship (edge) in result set, as Relay connection

.GraphQL-Query
[source,graphql]
----
{
  programmeItems {
    productTitle
    episodeNumber
    releatsToConnection {
      edges {
        node {
          ... on ProgrammeItem {
            productTitle
          }
          ... on Season {
            productTitle
          }
          ... on Series {
            productTitle
          }
        }
      }
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{ }
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:ProgrammeItem)
CALL {
	WITH this
	CALL {
		WITH this
		MATCH (this)-[this0:RELATES_TO]-(this1:Series)
		WITH {
			node: {
				__resolveType: 'Series',
				__id: id(this1),
				productTitle: this1.productTitle
			}
		} AS edge
		RETURN edge UNION
		WITH this
		MATCH (this)-[this2:RELATES_TO]-(this3:Season)
		WITH {
			node: {
				__resolveType: 'Season',
				__id: id(this3),
				productTitle: this3.productTitle
			}
		} AS edge
		RETURN edge UNION
		WITH this
		MATCH (this)-[this4:RELATES_TO]-(this5:ProgrammeItem)
		WITH {
			node: {
				__resolveType: 'ProgrammeItem',
				__id: id(this5),
				productTitle: this5.productTitle
			}
		} AS edge
		RETURN edge
	}
	WITH collect(edge) AS edges
	WITH edges, size(edges) AS totalCount
	RETURN {
		edges: edges,
		totalCount: totalCount
	} AS var6
}
RETURN this {
	.productTitle,
	.episodeNumber,
	releatsToConnection: var6
} AS this
----

'''

