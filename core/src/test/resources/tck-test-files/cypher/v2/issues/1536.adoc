:toc:

= https://github.com/neo4j/graphql/issues/1536

== Source schema

[source,graphql,schema=true]
----
type SomeNode {
  id: ID! @id @unique
  other: OtherNode! @relationship(type: "HAS_OTHER_NODES", direction: OUT)
}

type OtherNode {
  id: ID! @id @unique
  interfaceField: MyInterface! @relationship(type: "HAS_INTERFACE_NODES", direction: OUT)
}

interface MyInterface {
  id: ID!
}

type MyImplementation implements MyInterface {
  id: ID! @id @unique
}
----
== query nested interfaces

.GraphQL-Query
[source,graphql]
----
{
  someNodes {
    id
    other {
      interfaceField {
        id
      }
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:SomeNode)
CALL {
    WITH this
    MATCH (this)-[this0:HAS_OTHER_NODES]->(this1:OtherNode)
    CALL {
        WITH this1
        CALL {
            WITH *
            MATCH (this1)-[this2:HAS_INTERFACE_NODES]->(this3:MyImplementation)
            WITH this3 { .id, __resolveType: "MyImplementation", __id: id(this3) } AS this3
            RETURN this3 AS var4
        }
        WITH var4
        RETURN head(collect(var4)) AS var4
    }
    WITH this1 { interfaceField: var4 } AS this1
    RETURN head(collect(this1)) AS var5
}
RETURN this { .id, other: var5 } AS this
----

'''

