:toc:

= https://github.com/neo4j/graphql/issues/1566

== Source schema

[source,graphql,schema=true]
----
type Content {
  id: Int!
  name: String!
}

type Project {
  id: Int!
  name: String!
}

union FeedItem = Content | Project

type Community {
  id: Int!
  name: String!
  hasFeedItems(limit: Int = 10, page: Int = 0): [FeedItem!]! @cypher(statement: """
  Match(this)-[:COMMUNITY_CONTENTPIECE_HASCONTENTPIECES|:COMMUNITY_PROJECT_HASASSOCIATEDPROJECTS]-(pag)
     return pag SKIP ($limit * $pageIndex) LIMIT $limit
  """, columnName: "pag")
}
----
== collect unions returned by cypher directive

.GraphQL-Query
[source,graphql]
----
{
  communities(where: {id: 4656564}) {
    id
    hasFeedItems {
      __typename
      ... on Content {
        name
      }
      ... on Project {
        name
      }
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0" : 4656564,
  "param1" : 10,
  "param2" : 0
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:Community)
WHERE this.id = $param0
CALL {
	WITH this
	CALL {
		WITH this
		WITH this AS this
		MATCH (this)-[:COMMUNITY_CONTENTPIECE_HASCONTENTPIECES|COMMUNITY_PROJECT_HASASSOCIATEDPROJECTS]-(pag)
		RETURN pag SKIP ($param1 * $param2Index) LIMIT $param1
	}
	WITH pag AS this0
	WITH *
	WHERE (this0:Content
		OR this0:Project)
	RETURN collect(CASE WHEN this0:Content THEN this0 {
		.name,
		__resolveType: 'Content'
	} WHEN this0:Project THEN this0 {
		.name,
		__resolveType: 'Project'
	} END) AS this0
}
RETURN this {
	.id,
	hasFeedItems: this0
} AS this
----

'''

