:toc:

= https://github.com/neo4j/graphql/issues/1628

== Source schema

[source,graphql,schema=true]
----
type frbr__Work @node(labels: ["frbr__Work", "Resource"]) @mutation(operations: []) {
  """IRI"""
  iri: ID! @unique @alias(property: "uri")
  dcterms__title: [dcterms_title!]! @relationship(type: "dcterms__title", direction: OUT)
}

type dcterms_title @node(labels: ["dcterms_title", "property"]) @mutation(operations: []) {
  value: String
}
----
== Filter generated by query doesn't utilise index

.GraphQL-Query
[source,graphql]
----
{
  frbrWorks(
    options: {limit: 10000}
    where: {dcterms__title_SOME: {value_CONTAINS: "0777"}}
  ) {
    iri
    dcterms__title(where: {value_CONTAINS: "0777"}) {
      value
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0": "0777",
  "param1": 10000,
  "param2": "0777"
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:frbr__Work:Resource)
WHERE EXISTS {
    MATCH (this)-[:dcterms__title]->(this0:dcterms_title:property)
    WHERE this0.value CONTAINS $param0
}
WITH *

LIMIT $param1
CALL {
    WITH this
    MATCH (this)-[this1:dcterms__title]->(this2:dcterms_title:property)
    WHERE this2.value CONTAINS $param2
    WITH this2 { .value } AS this2
    RETURN collect(this2) AS var3
}
RETURN this { iri: this.uri, dcterms__title: var3 } AS this
----

'''

