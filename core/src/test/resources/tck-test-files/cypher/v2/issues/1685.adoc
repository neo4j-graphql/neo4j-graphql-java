:toc:

= https://github.com/neo4j/graphql/issues/1685

== Source schema

[source,graphql,schema=true]
----
interface Production {
  id: ID
  title: String
}

type Movie implements Production {
  id: ID
  title: String
  actorCount: Int
  genres: [Genre!]! @relationship(type: "HAS_GENRE", direction: OUT)
}

type Genre {
  name: String
  movies: [Production!]! @relationship(type: "HAS_GENRE", direction: IN)
}
----
== should be possible to count connection using list predicates

.GraphQL-Query
[source,graphql]
----
query Genres {
  genres {
    moviesConnection(
      where: {node: {_on: {Movie: {genresConnection_SOME: {node: {name: "Action"}}}}}}
    ) {
      totalCount
    }
    name
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0": "Action"
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:Genre)
CALL {
    WITH this
    CALL {
        WITH this
        MATCH (this)<-[this0:HAS_GENRE]-(this1:Movie)
        WHERE EXISTS {
            MATCH (this1)-[this2:HAS_GENRE]->(this3:Genre)
            WHERE this3.name = $param0
        }
        WITH { node: { __resolveType: "Movie", __id: id(this1) } } AS edge
        RETURN edge
    }
    WITH collect(edge) AS edges
    WITH edges, size(edges) AS totalCount
    RETURN { edges: edges, totalCount: totalCount } AS var4
}
RETURN this { .name, moviesConnection: var4 } AS this
----

'''

