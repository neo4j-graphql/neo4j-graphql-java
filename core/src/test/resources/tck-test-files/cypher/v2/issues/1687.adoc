:toc:
:toclevels: 42

= https://github.com/neo4j/graphql/issues/1687

== Setup

.Schema
[source,graphql,schema=true]
----
interface Production {
  id: ID
  title: String
}

type Movie implements Production {
  id: ID
  title: String
  actorCount: Int
  genres: [Genre!]! @relationship(type: "HAS_GENRE", direction: OUT)
}

type Genre {
  name: String
  movies: [Production!]! @relationship(type: "HAS_GENRE", direction: IN)
}
----

== should be able to return all the genres related to the Matrix movie using connection fields

.GraphQL-Query
[source,graphql,request=true]
----
query Genres {
  genres(where: {moviesConnection_ALL: {node: {title: "Matrix"}}}) {
    name
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0" : "Matrix"
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:Genre)
WHERE (EXISTS {
		MATCH (this0)-[edge:HAS_GENRE]->(this)
		WHERE (this0.title = $param0
			AND this0:Movie)
	}
	AND NOT (EXISTS {
		MATCH (this0)-[edge:HAS_GENRE]->(this)
		WHERE NOT ((this0.title = $param0
			AND this0:Movie))
	}))
RETURN this {
	.name
} AS this
----
