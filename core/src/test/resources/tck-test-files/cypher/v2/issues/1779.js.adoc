// This file was generated by the Test-Case extractor of neo4j-graphql
:toc:
:toclevels: 42

= https://github.com/neo4j/graphql/issues/1779

== Setup

.Schema
[source,graphql,schema=true]
----
type Person {
  name: String
  age: Int
  attends: [School!]! @relationship(type: "attends", direction: OUT)
}

type School {
  name: String
  students: [Person!]! @relationship(type: "attends", direction: IN)
}
----

== EXISTS should not be within return clause

.GraphQL-Query
[source,graphql,request=true]
----
{
  people {
    name
    attends(where: {students_ALL: {age_GT: 23}}) {
      name
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0": 23
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:Person)
CALL {
    WITH this
    MATCH (this)-[this0:attends]->(this1:School)
    WHERE (EXISTS {
        MATCH (this1)<-[:attends]-(this2:Person)
        WHERE this2.age > $param0
    } AND NOT (EXISTS {
        MATCH (this1)<-[:attends]-(this2:Person)
        WHERE NOT (this2.age > $param0)
    }))
    WITH this1 { .name } AS this1
    RETURN collect(this1) AS var3
}
RETURN this { .name, attends: var3 } AS this
----
