:toc:

= #190

== Source schema

[source,graphql,schema=true]
----
type User {
  client_id: String
  uid: String
  demographics: [UserDemographics!]! @relationship(type: "HAS_DEMOGRAPHIC", direction: OUT)
}

type UserDemographics {
  client_id: String
  type: String
  value: String
  users: [User!]! @relationship(type: "HAS_DEMOGRAPHIC", direction: IN)
}
----
== Example 1

.GraphQL-Query
[source,graphql]
----
{
  users(where: {demographics: {type: "Gender", value: "Female"}}) {
    uid
    demographics {
      type
      value
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0" : "Gender",
  "param1" : "Female"
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:User)
WHERE EXISTS {
	MATCH (this)-[:HAS_DEMOGRAPHIC]->(this0:UserDemographics)
	WHERE (this0.type = $param0
		AND this0.value = $param1)
}
CALL {
	WITH this
	MATCH (this)-[this1:HAS_DEMOGRAPHIC]->(this2:UserDemographics)
	WITH this2 {
		.type,
		.value
	} AS this2
	RETURN collect(this2) AS var3
}
RETURN this {
	.uid,
	demographics: var3
} AS this
----

'''

== Example 2

.GraphQL-Query
[source,graphql]
----
{
  users(
    where: {demographics: {OR: [{type: "Gender", value: "Female"}, {type: "State"}, {type: "Age"}]}}
  ) {
    uid
    demographics {
      type
      value
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0" : "Gender",
  "param1" : "Female",
  "param2" : "State",
  "param3" : "Age"
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:User)
WHERE EXISTS {
	MATCH (this)-[:HAS_DEMOGRAPHIC]->(this0:UserDemographics)
	WHERE ((this0.type = $param0
			AND this0.value = $param1)
		OR this0.type = $param2
		OR this0.type = $param3)
}
CALL {
	WITH this
	MATCH (this)-[this1:HAS_DEMOGRAPHIC]->(this2:UserDemographics)
	WITH this2 {
		.type,
		.value
	} AS this2
	RETURN collect(this2) AS var3
}
RETURN this {
	.uid,
	demographics: var3
} AS this
----

'''

