:toc:
:toclevels: 42

= #360

== Setup

.Schema
[source,graphql,schema=true]
----
type Event {
  id: ID!
  name: String
  start: DateTime
  end: DateTime
  activity: String
}
----

== Should exclude undefined members in AND

.GraphQL-Query
[source,graphql,request=true]
----
query ($rangeStart: DateTime, $rangeEnd: DateTime, $activity: String) {
  events(
    where: {AND: [{start_GTE: $rangeStart}, {start_LTE: $rangeEnd}, {activity: $activity}]}
  ) {
    start
    activity
  }
}
----

.GraphQL params input
[source,json,request=true]
----
{
  "rangeEnd" : "2021-07-18T23:59:59+0100",
  "rangeStart" : "2021-07-18T00:00:00+0100"
}
----

.Expected Cypher params
[source,json]
----
{
  "param0" : "2021-07-18T00:00:00+01:00",
  "param1" : "2021-07-18T23:59:59+01:00"
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:Event)
WHERE (this.start >= $param0
	AND this.start <= $param1)
RETURN this {
	start: apoc.date.convertFormat(toString(this.start), 'iso_zoned_date_time', 'iso_offset_date_time'),
	.activity
} AS this
----

== Should exclude undefined members in OR

.GraphQL-Query
[source,graphql,request=true]
----
query ($rangeStart: DateTime, $rangeEnd: DateTime, $activity: String) {
  events(
    where: {OR: [{start_GTE: $rangeStart}, {start_LTE: $rangeEnd}, {activity: $activity}]}
  ) {
    start
    activity
  }
}
----

.GraphQL params input
[source,json,request=true]
----
{
  "rangeEnd" : "2021-07-18T23:59:59+0100",
  "rangeStart" : "2021-07-18T00:00:00+0100"
}
----

.Expected Cypher params
[source,json]
----
{
  "param0" : "2021-07-18T00:00:00+01:00",
  "param1" : "2021-07-18T23:59:59+01:00"
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:Event)
WHERE (this.start >= $param0
	OR this.start <= $param1)
RETURN this {
	start: apoc.date.convertFormat(toString(this.start), 'iso_zoned_date_time', 'iso_offset_date_time'),
	.activity
} AS this
----
