:toc:

= https://github.com/neo4j/graphql/issues/387

== Source schema

[source,graphql,schema=true]
----
scalar URL

type Place {
  name: String
  url_works: String @cypher(statement: """return '' + '' as result""", columnName: "result")
  url_fails: URL @cypher(statement: """return '' + '' as result""", columnName: "result")
  url_array_works: [String] @cypher(statement: """return ['' + ''] as result""", columnName: "result")
  url_array_fails: [URL] @cypher(statement: """return ['' + ''] as result""", columnName: "result")
}
----
== Should project custom scalars from custom Cypher correctly

.GraphQL-Query
[source,graphql]
----
{
  places {
    url_works
    url_fails
    url_array_works
    url_array_fails
  }
}
----

.Expected Cypher params
[source,json]
----
{ }
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:Place)
CALL {
	WITH this
	CALL {
		WITH this
		WITH this AS this
		RETURN ('' + '') AS result
	}
	UNWIND result AS this0
	RETURN head(collect(this0)) AS this0
}
CALL {
	WITH this
	CALL {
		WITH this
		WITH this AS this
		RETURN ('' + '') AS result
	}
	UNWIND result AS this1
	RETURN head(collect(this1)) AS this1
}
CALL {
	WITH this
	CALL {
		WITH this
		WITH this AS this
		RETURN [('' + '')] AS result
	}
	UNWIND result AS this2
	RETURN collect(this2) AS this2
}
CALL {
	WITH this
	CALL {
		WITH this
		WITH this AS this
		RETURN [('' + '')] AS result
	}
	UNWIND result AS this3
	RETURN collect(this3) AS this3
}
RETURN this {
	url_works: this0,
	url_fails: this1,
	url_array_works: this2,
	url_array_fails: this3
} AS this
----

'''

