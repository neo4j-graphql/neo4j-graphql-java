:toc:

= https://github.com/neo4j/graphql/issues/387

== Source schema

[source,graphql,schema=true]
----
scalar URL

type Place {
  name: String
  url_works: String @cypher(statement: """return '' + '' as result""", columnName: "result")
  url_fails: URL @cypher(statement: """return '' + '' as result""", columnName: "result")
  url_array_works: [String] @cypher(statement: """return ['' + ''] as result""", columnName: "result")
  url_array_fails: [URL] @cypher(statement: """return ['' + ''] as result""", columnName: "result")
}
----
== Should project custom scalars from custom Cypher correctly

.GraphQL-Query
[source,graphql]
----
{
  places {
    url_works
    url_fails
    url_array_works
    url_array_fails
  }
}
----

.Expected Cypher params
[source,json]
----
{}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:Place)
CALL {
    WITH this
    CALL {
        WITH this
        WITH this AS this
        return '' + '' as result
    }
    WITH result AS this0
    RETURN this0 AS var1
}
CALL {
    WITH this
    CALL {
        WITH this
        WITH this AS this
        return '' + '' as result
    }
    WITH result AS this2
    RETURN this2 AS var3
}
CALL {
    WITH this
    CALL {
        WITH this
        WITH this AS this
        return ['' + ''] as result
    }
    UNWIND result AS var4
    WITH var4 AS this5
    RETURN collect(this5) AS var6
}
CALL {
    WITH this
    CALL {
        WITH this
        WITH this AS this
        return ['' + ''] as result
    }
    UNWIND result AS var7
    WITH var7 AS this8
    RETURN collect(this8) AS var9
}
RETURN this { url_works: var1, url_fails: var3, url_array_works: var6, url_array_fails: var9 } AS this
----

'''

