:toc:

= https://github.com/neo4j/graphql/issues/3923

== Source schema

[source,graphql,schema=true]
----
interface Production {
  id: ID
  title: String
}

type Movie implements Production {
  id: ID
  title: String
  actorCount: Int
  genres: [Genre!]! @relationship(type: "HAS_GENRE", direction: OUT)
}

type Series implements Production {
  id: ID
  title: String
  tagline: String
}

type Genre {
  name: String
  movies: [Production!]! @relationship(type: "HAS_GENRE", direction: IN)
}
----
== should be able to return all the genres related to the Matrix movie or series using connection fields

.GraphQL-Query
[source,graphql]
----
query Genres {
  genres(
    where: {moviesConnection_ALL: {node: {_on: {Movie: {title: "Matrix"}, Series: {tagline: "Mr.Anderson"}}}}}
  ) {
    name
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0": "Matrix",
  "param1": "Mr.Anderson"
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:Genre)
WHERE ((EXISTS {
    MATCH (this)<-[this0:HAS_GENRE]-(this1:Movie)
    WHERE this1.title = $param0
} AND NOT (EXISTS {
    MATCH (this)<-[this0:HAS_GENRE]-(this1:Movie)
    WHERE NOT (this1.title = $param0)
})) AND (EXISTS {
    MATCH (this)<-[this2:HAS_GENRE]-(this3:Series)
    WHERE this3.tagline = $param1
} AND NOT (EXISTS {
    MATCH (this)<-[this2:HAS_GENRE]-(this3:Series)
    WHERE NOT (this3.tagline = $param1)
})))
RETURN this { .name } AS this
----

'''

