:toc:

= https://github.com/neo4j/graphql/issues/487

== Source schema

[source,graphql,schema=true]
----
type Author {
  id: ID!
}

type Director {
  id: ID!
}

type Book implements Thing {
  id: ID!
  author: Author! @relationship(type: "WROTE", direction: IN)
}

type Movie implements Thing {
  id: ID!
  director: Director! @relationship(type: "DIRECTED", direction: IN)
}

interface Thing {
  id: ID!
}

type Query {
  getThings: [Thing!] @cypher(statement: """
  MATCH (node)
  WHERE
      "Book" IN labels(node) OR
      "Movie" IN labels(node)
  RETURN node
  """, columnName: "node")
}
----
== related fields should resolve on custom queries (interface)

.GraphQL-Query
[source,graphql]
----
{
  getThings {
    __typename
    id
    ... on Book {
      author {
        id
      }
      __typename
    }
    ... on Movie {
      director {
        id
      }
      __typename
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{}
----

.Expected Cypher output
[source,cypher]
----
CALL {
    MATCH (node)
    WHERE
        "Book" IN labels(node) OR
        "Movie" IN labels(node)
    RETURN node
}
WITH node AS this0
CALL {
    WITH this0
    CALL {
        WITH *
        MATCH (this0)
        WHERE this0:Book
        CALL {
            WITH this0
            MATCH (this0)<-[this1:WROTE]-(this2:Author)
            WITH this2 { .id } AS this2
            RETURN head(collect(this2)) AS var3
        }
        WITH this0 { .id, author: var3, __resolveType: "Book", __id: id(this0) } AS this0
        RETURN this0 AS var4
        UNION
        WITH *
        MATCH (this0)
        WHERE this0:Movie
        CALL {
            WITH this0
            MATCH (this0)<-[this5:DIRECTED]-(this6:Director)
            WITH this6 { .id } AS this6
            RETURN head(collect(this6)) AS var7
        }
        WITH this0 { .id, director: var7, __resolveType: "Movie", __id: id(this0) } AS this0
        RETURN this0 AS var4
    }
    RETURN var4
}
RETURN var4 AS this0
----

'''

