:toc:

= Cypher Points

== Source schema

[source,graphql,schema=true]
----
type PointContainer {
  id: String
  point: Point
}
----

== Configuration

.Configuration
[source,json,schema-config=true]
----
{
  "enableRegex": true
}
----
== Simple Point create mutation

.GraphQL-Query
[source,graphql]
----
mutation {
  createPointContainers(input: {point: {longitude: 1.0, latitude: 2.0}}) {
    pointContainers {
      point {
        longitude
        latitude
        crs
      }
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "create_param0" : [ {
    "point" : {
      "longitude" : 1,
      "latitude" : 2
    }
  } ]
}
----

.Expected Cypher output
[source,cypher]
----
UNWIND $create_param0 AS create_var1
CALL {
	WITH create_var1
	CREATE (create_this0:PointContainer)
	SET create_this0.point = point(create_var1.point)
	RETURN create_this0
}
RETURN collect(create_this0 {
	point: CASE WHEN create_this0.point IS NOT NULL THEN {
		point: create_this0.point,
		crs: create_this0.point.crs
	} ELSE NULL END
}) AS data
----

'''

== Simple Point IN query

.GraphQL-Query
[source,graphql]
----
{
  pointContainers(where: {point_IN: [{longitude: 1.0, latitude: 2.0}]}) {
    point {
      longitude
      latitude
      crs
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0" : [ {
    "longitude" : 1,
    "latitude" : 2
  } ]
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:PointContainer)
WHERE this.point IN [var0 IN $param0 | point(var0)]
RETURN this {
	point: CASE WHEN this.point IS NOT NULL THEN {
		point: this.point,
		crs: this.point.crs
	} ELSE NULL END
} AS this
----

'''

== Simple Point NOT IN query

.GraphQL-Query
[source,graphql]
----
{
  pointContainers(where: {point_NOT_IN: [{longitude: 1.0, latitude: 2.0}]}) {
    point {
      longitude
      latitude
      crs
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0" : [ {
    "longitude" : 1,
    "latitude" : 2
  } ]
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:PointContainer)
WHERE NOT (this.point IN [var0 IN $param0 | point(var0)])
RETURN this {
	point: CASE WHEN this.point IS NOT NULL THEN {
		point: this.point,
		crs: this.point.crs
	} ELSE NULL END
} AS this
----

'''

== Simple Point NOT query

.GraphQL-Query
[source,graphql]
----
{
  pointContainers(where: {point_NOT: {longitude: 1.0, latitude: 2.0}}) {
    point {
      longitude
      latitude
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0" : {
    "longitude" : 1,
    "latitude" : 2
  }
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:PointContainer)
WHERE NOT (this.point = point($param0))
RETURN this {
	point: CASE WHEN this.point IS NOT NULL THEN {
		point: this.point
	} ELSE NULL END
} AS this
----

'''

== Simple Point query

.GraphQL-Query
[source,graphql]
----
{
  pointContainers(where: {point: {longitude: 1.0, latitude: 2.0}}) {
    point {
      longitude
      latitude
      crs
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0" : {
    "longitude" : 1,
    "latitude" : 2
  }
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:PointContainer)
WHERE this.point = point($param0)
RETURN this {
	point: CASE WHEN this.point IS NOT NULL THEN {
		point: this.point,
		crs: this.point.crs
	} ELSE NULL END
} AS this
----

'''

== Simple Point update mutation

.GraphQL-Query
[source,graphql]
----
mutation {
  updatePointContainers(
    where: {id: "id"}
    update: {point: {longitude: 1.0, latitude: 2.0}}
  ) {
    pointContainers {
      point {
        longitude
        latitude
        crs
      }
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0" : "id",
  "this_update_point" : {
    "longitude" : 1,
    "latitude" : 2
  }
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:PointContainer)
WHERE this.id = $param0
SET this.point = point($this_update_point)
RETURN collect(DISTINCT this {
	point: CASE WHEN this.point IS NOT NULL THEN {
		point: this.point,
		crs: this.point.crs
	} ELSE NULL END
}) AS data
----

'''

== tests using describe or point.describe

=== Simple Point DISTANCE query

.GraphQL-Query
[source,graphql]
----
{
  pointContainers(
    where: {point_DISTANCE: {point: {longitude: 1.1, latitude: 2.2}, distance: 3.3}}
  ) {
    point {
      longitude
      latitude
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0" : {
    "point" : {
      "longitude" : 1.1,
      "latitude" : 2.2
    },
    "distance" : 3.3
  }
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:PointContainer)
WHERE distance(this.point, point($param0.point)) = $param0.distance
RETURN this {
	point: CASE WHEN this.point IS NOT NULL THEN {
		point: this.point
	} ELSE NULL END
} AS this
----

'''

=== Simple Point DISTANCE query (4.4)

.GraphQL-Query
[source,graphql]
----
{
  pointContainers(
    where: {point_DISTANCE: {point: {longitude: 1.1, latitude: 2.2}, distance: 3.3}}
  ) {
    point {
      longitude
      latitude
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0" : {
    "point" : {
      "longitude" : 1.1,
      "latitude" : 2.2
    },
    "distance" : 3.3
  }
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:PointContainer)
WHERE point.distance(this.point, point($param0.point)) = $param0.distance
RETURN this {
	point: CASE WHEN this.point IS NOT NULL THEN {
		point: this.point
	} ELSE NULL END
} AS this
----

'''

=== Simple Point GT query

.GraphQL-Query
[source,graphql]
----
{
  pointContainers(
    where: {point_GT: {point: {longitude: 1.1, latitude: 2.2}, distance: 3.3}}
  ) {
    point {
      longitude
      latitude
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0" : {
    "point" : {
      "longitude" : 1.1,
      "latitude" : 2.2
    },
    "distance" : 3.3
  }
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:PointContainer)
WHERE distance(this.point, point($param0.point)) > $param0.distance
RETURN this {
	point: CASE WHEN this.point IS NOT NULL THEN {
		point: this.point
	} ELSE NULL END
} AS this
----

'''

=== Simple Point GT query (4.4)

.GraphQL-Query
[source,graphql]
----
{
  pointContainers(
    where: {point_GT: {point: {longitude: 1.1, latitude: 2.2}, distance: 3.3}}
  ) {
    point {
      longitude
      latitude
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0" : {
    "point" : {
      "longitude" : 1.1,
      "latitude" : 2.2
    },
    "distance" : 3.3
  }
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:PointContainer)
WHERE point.distance(this.point, point($param0.point)) > $param0.distance
RETURN this {
	point: CASE WHEN this.point IS NOT NULL THEN {
		point: this.point
	} ELSE NULL END
} AS this
----

'''

=== Simple Point GTE query

.GraphQL-Query
[source,graphql]
----
{
  pointContainers(
    where: {point_GTE: {point: {longitude: 1.1, latitude: 2.2}, distance: 3.3}}
  ) {
    point {
      longitude
      latitude
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0" : {
    "point" : {
      "longitude" : 1.1,
      "latitude" : 2.2
    },
    "distance" : 3.3
  }
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:PointContainer)
WHERE distance(this.point, point($param0.point)) >= $param0.distance
RETURN this {
	point: CASE WHEN this.point IS NOT NULL THEN {
		point: this.point
	} ELSE NULL END
} AS this
----

'''

=== Simple Point GTE query (4.4)

.GraphQL-Query
[source,graphql]
----
{
  pointContainers(
    where: {point_GTE: {point: {longitude: 1.1, latitude: 2.2}, distance: 3.3}}
  ) {
    point {
      longitude
      latitude
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0" : {
    "point" : {
      "longitude" : 1.1,
      "latitude" : 2.2
    },
    "distance" : 3.3
  }
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:PointContainer)
WHERE point.distance(this.point, point($param0.point)) >= $param0.distance
RETURN this {
	point: CASE WHEN this.point IS NOT NULL THEN {
		point: this.point
	} ELSE NULL END
} AS this
----

'''

=== Simple Point LT query

.GraphQL-Query
[source,graphql]
----
{
  pointContainers(
    where: {point_LT: {point: {longitude: 1.1, latitude: 2.2}, distance: 3.3}}
  ) {
    point {
      longitude
      latitude
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0" : {
    "point" : {
      "longitude" : 1.1,
      "latitude" : 2.2
    },
    "distance" : 3.3
  }
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:PointContainer)
WHERE distance(this.point, point($param0.point)) < $param0.distance
RETURN this {
	point: CASE WHEN this.point IS NOT NULL THEN {
		point: this.point
	} ELSE NULL END
} AS this
----

'''

=== Simple Point LT query (4.4)

.GraphQL-Query
[source,graphql]
----
{
  pointContainers(
    where: {point_LT: {point: {longitude: 1.1, latitude: 2.2}, distance: 3.3}}
  ) {
    point {
      longitude
      latitude
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0" : {
    "point" : {
      "longitude" : 1.1,
      "latitude" : 2.2
    },
    "distance" : 3.3
  }
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:PointContainer)
WHERE point.distance(this.point, point($param0.point)) < $param0.distance
RETURN this {
	point: CASE WHEN this.point IS NOT NULL THEN {
		point: this.point
	} ELSE NULL END
} AS this
----

'''

=== Simple Point LTE query

.GraphQL-Query
[source,graphql]
----
{
  pointContainers(
    where: {point_LTE: {point: {longitude: 1.1, latitude: 2.2}, distance: 3.3}}
  ) {
    point {
      longitude
      latitude
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0" : {
    "point" : {
      "longitude" : 1.1,
      "latitude" : 2.2
    },
    "distance" : 3.3
  }
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:PointContainer)
WHERE distance(this.point, point($param0.point)) <= $param0.distance
RETURN this {
	point: CASE WHEN this.point IS NOT NULL THEN {
		point: this.point
	} ELSE NULL END
} AS this
----

'''

=== Simple Point LTE query (4.4)

.GraphQL-Query
[source,graphql]
----
{
  pointContainers(
    where: {point_LTE: {point: {longitude: 1.1, latitude: 2.2}, distance: 3.3}}
  ) {
    point {
      longitude
      latitude
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0" : {
    "point" : {
      "longitude" : 1.1,
      "latitude" : 2.2
    },
    "distance" : 3.3
  }
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:PointContainer)
WHERE point.distance(this.point, point($param0.point)) <= $param0.distance
RETURN this {
	point: CASE WHEN this.point IS NOT NULL THEN {
		point: this.point
	} ELSE NULL END
} AS this
----

'''


