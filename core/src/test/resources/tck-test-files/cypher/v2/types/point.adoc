:toc:
:toclevels: 42

= Cypher Points

== Setup

.Schema
[source,graphql,schema=true]
----
type PointContainer {
  id: String
  point: Point
}
----

== Simple Point query

.GraphQL-Query
[source,graphql,request=true]
----
{
  pointContainers(where: {point: {longitude: 1.0, latitude: 2.0}}) {
    point {
      longitude
      latitude
      crs
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0" : {
    "longitude" : 1,
    "latitude" : 2
  }
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:PointContainer)
WHERE this.point = point($param0)
RETURN this {
	point: CASE WHEN this.point IS NOT NULL THEN {
		longitude: this.point.longitude,
		latitude: this.point.latitude,
		crs: this.point.crs
	} ELSE NULL END
} AS this
----

== Simple Point IN query

.GraphQL-Query
[source,graphql,request=true]
----
{
  pointContainers(where: {point_IN: [{longitude: 1.0, latitude: 2.0}]}) {
    point {
      longitude
      latitude
      crs
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0" : [ {
    "longitude" : 1,
    "latitude" : 2
  } ]
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:PointContainer)
WHERE this.point IN [p IN $param0 | point(p)]
RETURN this {
	point: CASE WHEN this.point IS NOT NULL THEN {
		longitude: this.point.longitude,
		latitude: this.point.latitude,
		crs: this.point.crs
	} ELSE NULL END
} AS this
----

== tests using describe or point.describe

=== Simple Point LT query

.GraphQL-Query
[source,graphql,request=true]
----
{
  pointContainers(
    where: {point_LT: {point: {longitude: 1.1, latitude: 2.2}, distance: 3.3}}
  ) {
    point {
      longitude
      latitude
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0" : {
    "point" : {
      "longitude" : 1.1,
      "latitude" : 2.2
    },
    "distance" : 3.3
  }
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:PointContainer)
WHERE point.distance(this.point, point($param0.point)) < $param0.distance
RETURN this {
	point: CASE WHEN this.point IS NOT NULL THEN {
		longitude: this.point.longitude,
		latitude: this.point.latitude
	} ELSE NULL END
} AS this
----

=== Simple Point LTE query

.GraphQL-Query
[source,graphql,request=true]
----
{
  pointContainers(
    where: {point_LTE: {point: {longitude: 1.1, latitude: 2.2}, distance: 3.3}}
  ) {
    point {
      longitude
      latitude
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0" : {
    "point" : {
      "longitude" : 1.1,
      "latitude" : 2.2
    },
    "distance" : 3.3
  }
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:PointContainer)
WHERE point.distance(this.point, point($param0.point)) <= $param0.distance
RETURN this {
	point: CASE WHEN this.point IS NOT NULL THEN {
		longitude: this.point.longitude,
		latitude: this.point.latitude
	} ELSE NULL END
} AS this
----

=== Simple Point GT query

.GraphQL-Query
[source,graphql,request=true]
----
{
  pointContainers(
    where: {point_GT: {point: {longitude: 1.1, latitude: 2.2}, distance: 3.3}}
  ) {
    point {
      longitude
      latitude
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0" : {
    "point" : {
      "longitude" : 1.1,
      "latitude" : 2.2
    },
    "distance" : 3.3
  }
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:PointContainer)
WHERE point.distance(this.point, point($param0.point)) > $param0.distance
RETURN this {
	point: CASE WHEN this.point IS NOT NULL THEN {
		longitude: this.point.longitude,
		latitude: this.point.latitude
	} ELSE NULL END
} AS this
----

=== Simple Point GTE query

.GraphQL-Query
[source,graphql,request=true]
----
{
  pointContainers(
    where: {point_GTE: {point: {longitude: 1.1, latitude: 2.2}, distance: 3.3}}
  ) {
    point {
      longitude
      latitude
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0" : {
    "point" : {
      "longitude" : 1.1,
      "latitude" : 2.2
    },
    "distance" : 3.3
  }
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:PointContainer)
WHERE point.distance(this.point, point($param0.point)) >= $param0.distance
RETURN this {
	point: CASE WHEN this.point IS NOT NULL THEN {
		longitude: this.point.longitude,
		latitude: this.point.latitude
	} ELSE NULL END
} AS this
----

=== Simple Point DISTANCE query

.GraphQL-Query
[source,graphql,request=true]
----
{
  pointContainers(
    where: {point_DISTANCE: {point: {longitude: 1.1, latitude: 2.2}, distance: 3.3}}
  ) {
    point {
      longitude
      latitude
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0" : {
    "point" : {
      "longitude" : 1.1,
      "latitude" : 2.2
    },
    "distance" : 3.3
  }
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:PointContainer)
WHERE point.distance(this.point, point($param0.point)) = $param0.distance
RETURN this {
	point: CASE WHEN this.point IS NOT NULL THEN {
		longitude: this.point.longitude,
		latitude: this.point.latitude
	} ELSE NULL END
} AS this
----
