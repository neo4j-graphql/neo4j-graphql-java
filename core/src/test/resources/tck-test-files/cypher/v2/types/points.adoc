:toc:

= Cypher Points

== Source schema

[source,graphql,schema=true]
----
type PointContainer {
  id: String
  points: [Point]
}
----
== Simple Points create mutation

.GraphQL-Query
[source,graphql]
----
mutation {
  createPointContainers(input: {points: [{longitude: 1.0, latitude: 2.0}]}) {
    pointContainers {
      points {
        longitude
        latitude
        crs
      }
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "create_param0": [
    {
      "points": [
        {
          "longitude": 1,
          "latitude": 2
        }
      ]
    }
  ]
}
----

.Expected Cypher output
[source,cypher]
----
UNWIND $create_param0 AS create_var0
CALL {
    WITH create_var0
    CREATE (create_this1:PointContainer)
    SET
        create_this1.points = [create_var2 IN create_var0.points | point(create_var2)]
    
    RETURN create_this1
}
RETURN collect(create_this1 { points: CASE
    WHEN create_this1.points IS NOT NULL THEN [create_var3 IN create_this1.points | { point: create_var3, crs: create_var3.crs }]
    ELSE NULL
END }) AS data
----

'''

== Simple Points INCLUDES query

.GraphQL-Query
[source,graphql]
----
{
  pointContainers(where: {points_INCLUDES: {longitude: 1.0, latitude: 2.0}}) {
    points {
      longitude
      latitude
      crs
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0": {
    "longitude": 1,
    "latitude": 2
  }
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:PointContainer)
WHERE point($param0) IN this.points
RETURN this { points: CASE
    WHEN this.points IS NOT NULL THEN [var0 IN this.points | { point: var0, crs: var0.crs }]
    ELSE NULL
END } AS this
----

'''

== Simple Points NOT INCLUDES query

.GraphQL-Query
[source,graphql]
----
{
  pointContainers(where: {points_NOT_INCLUDES: {longitude: 1.0, latitude: 2.0}}) {
    points {
      longitude
      latitude
      crs
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0": {
    "longitude": 1,
    "latitude": 2
  }
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:PointContainer)
WHERE NOT (point($param0) IN this.points)
RETURN this { points: CASE
    WHEN this.points IS NOT NULL THEN [var0 IN this.points | { point: var0, crs: var0.crs }]
    ELSE NULL
END } AS this
----

'''

== Simple Points NOT query

.GraphQL-Query
[source,graphql]
----
{
  pointContainers(where: {points_NOT: [{longitude: 1.0, latitude: 2.0}]}) {
    points {
      longitude
      latitude
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0": [
    {
      "longitude": 1,
      "latitude": 2
    }
  ]
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:PointContainer)
WHERE NOT (this.points = [var0 IN $param0 | point(var0)])
RETURN this { points: CASE
    WHEN this.points IS NOT NULL THEN [var1 IN this.points | { point: var1 }]
    ELSE NULL
END } AS this
----

'''

== Simple Points query

.GraphQL-Query
[source,graphql]
----
{
  pointContainers(where: {points: [{longitude: 1.0, latitude: 2.0}]}) {
    points {
      longitude
      latitude
      crs
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0": [
    {
      "longitude": 1,
      "latitude": 2
    }
  ]
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:PointContainer)
WHERE this.points = [var0 IN $param0 | point(var0)]
RETURN this { points: CASE
    WHEN this.points IS NOT NULL THEN [var1 IN this.points | { point: var1, crs: var1.crs }]
    ELSE NULL
END } AS this
----

'''

== Simple Points update mutation

.GraphQL-Query
[source,graphql]
----
mutation {
  updatePointContainers(
    where: {id: "id"}
    update: {points: [{longitude: 1.0, latitude: 2.0}]}
  ) {
    pointContainers {
      points {
        longitude
        latitude
        crs
      }
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{
  "param0": "id",
  "this_update_points": [
    {
      "longitude": 1,
      "latitude": 2
    }
  ]
}
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:PointContainer)
WHERE this.id = $param0


SET this.points = [p in $this_update_points | point(p)]

RETURN collect(DISTINCT this { points: CASE
    WHEN this.points IS NOT NULL THEN [update_var0 IN this.points | { point: update_var0, crs: update_var0.crs }]
    ELSE NULL
END }) AS data
----

'''

