:toc:

= Undirected relationships

== Source schema

[source,graphql,schema=true]
----
type Foo {
  id: ID @unique
  Name: String
  Age: Int
  DrinksAt: Bar @relationship(type: "DRINKS_AT", direction: OUT)
}

type Bar {
  id: ID @unique
  Adress: String
  Customers: [Foo!]! @relationship(type: "DRINKS_AT", direction: IN)
}
----
== nested undirected relationship

.GraphQL-Query
[source,graphql]
----
query Query {
  foos {
    DrinksAt {
      id
      Customers(directed: false) {
        Name
      }
    }
  }
}
----

.Expected Cypher params
[source,json]
----
{ }
----

.Expected Cypher output
[source,cypher]
----
MATCH (this:Foo)
CALL {
	WITH this
	MATCH (this)-[this0:DRINKS_AT]->(this1:Bar)
	CALL {
		WITH this1
		MATCH (this1)-[this2:DRINKS_AT]-(this3:Foo)
		WITH this3 {
			.Name
		} AS this3
		RETURN collect(this3) AS var4
	}
	WITH this1 {
		.id,
		Customers: var4
	} AS this1
	RETURN head(collect(this1)) AS var5
}
RETURN this {
	DrinksAt: var5
} AS this
----

'''

