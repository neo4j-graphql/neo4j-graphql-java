:toc:

= Augmentation Tests

== Schema

[source,graphql,schema=true]
----
type Person0 { name: String }
type Person1 { name: String }
type Person2 { name: String, age: [Int] }
type Person3 { name: String!}
type Person4 { id:ID!, name: String}
type Person5 { id:ID!, movies:[Movie] @relation(name: "LIKES")}
type Movie { id:ID!, publishedBy: Publisher @relation(name: "PUBLISHED_BY")}
type Publisher { name:ID! }
type Knows0 @relation(name:"KNOWS", from: "source", to: "knows"){
  id: ID!
  source: Person0!
  knows: Person0!
  json: Object @dynamic(prefix: "prefix.")
}
type Knows1 @relation(name:"KNOWS", from: "source", to: "knows"){
  id: ID!
  source: Person0!
  knows: Person0!
}
type Knows4 @relation(name:"KNOWS", from: "source", to: "knows"){
  _id: ID!
  source: Person4!
  knows: Person4!
  json: Object @dynamic(prefix: "prefix.")
}
----

== Augmentation

=== Disable Queries

.Configuration
[source,json]
----
{
  "query": {
    "enabled": false
  },
  "mutation": {
    "enabled": true,
    "exclude": [
      "Person0"
    ]
  }
}
----

.Augmented Schema
[source,graphql]
----
schema {
  query: Query
  mutation: Mutation
}

type Knows0 @relation(direction : OUT, from : "source", name : "KNOWS", to : "knows") {
  id: ID!
  json: Object @dynamic(prefix : "prefix.")
  knows: Person0!
  source: Person0!
}

type Knows1 @relation(direction : OUT, from : "source", name : "KNOWS", to : "knows") {
  id: ID!
  knows: Person0!
  source: Person0!
}

type Knows4 @relation(direction : OUT, from : "source", name : "KNOWS", to : "knows") {
  _id: ID!
  json: Object @dynamic(prefix : "prefix.")
  knows: Person4!
  source: Person4!
}

type Movie {
  id: ID!
  publishedBy: Publisher @relation(direction : OUT, from : "from", name : "PUBLISHED_BY", to : "to")
}

type Mutation {
  deleteKnows0(id: ID!): ID
  mergeKnows0(id: ID!, json: Object): Knows0!
  updateKnows0(id: ID!, json: Object): Knows0!

  deleteKnows1(id: ID!): ID

  createKnows4(json: Object, knows_id: ID!, source_id: ID!): Knows4!
  deleteKnows4(_id: ID!): ID
  mergeKnows4(_id: ID!, json: Object): Knows4!
  updateKnows4(_id: ID!, json: Object): Knows4!

  createMovie(id: ID!): Movie!
  deleteMovie(id: ID!): ID

  addMoviePublishedBy(id: ID!, publishedBy: ID!): Movie!
  deleteMoviePublishedBy(id: ID!, publishedBy: ID!): Movie!

  createPerson1(name: String): Person1!

  createPerson2(age: [Int], name: String): Person2!

  createPerson3(name: String!): Person3!

  createPerson4(id: ID!, name: String): Person4!
  deletePerson4(id: ID!): ID
  mergePerson4(id: ID!, name: String): Person4!
  updatePerson4(id: ID!, name: String): Person4!

  createPerson5(id: ID!): Person5!
  deletePerson5(id: ID!): ID

  addPerson5Movies(id: ID!, movies: [ID!]!): Person5!
  deletePerson5Movies(id: ID!, movies: [ID!]!): Person5!

  createPublisher(name: ID!): Publisher!
  deletePublisher(name: ID!): ID
}

type Person0 {
  name: String
}

type Person1 {
  name: String
}

type Person2 {
  age: [Int]
  name: String
}

type Person3 {
  name: String!
}

type Person4 {
  id: ID!
  name: String
}

type Person5 {
  id: ID!
  movies: [Movie] @relation(direction : OUT, from : "from", name : "LIKES", to : "to")
}

type Publisher {
  name: ID!
}

type Query {
}

enum RelationDirection {
  IN
  OUT
  BOTH
}

directive @relation(name:String, direction: RelationDirection = OUT, from: String = "from", to: String = "to") on FIELD_DEFINITION | OBJECT
directive @cypher(statement:String) on FIELD_DEFINITION
directive @property(name:String) on FIELD_DEFINITION
directive @dynamic(prefix:String = "properties.") on FIELD_DEFINITION
scalar Object

----

=== Disable Mutations

.Configuration
[source,json]
----
{
  "query": {
    "enabled": true,
    "exclude": [
      "Person0"
    ]
  },
  "mutation": {
    "enabled": false
  }
}
----

.Augmented Schema
[source,graphql]
----
schema {
  query: Query
  mutation: Mutation
}

type Knows0 @relation(direction : OUT, from : "source", name : "KNOWS", to : "knows") {
  id: ID!
  json: Object @dynamic(prefix : "prefix.")
  knows: Person0!
  source: Person0!
}

type Knows1 @relation(direction : OUT, from : "source", name : "KNOWS", to : "knows") {
  id: ID!
  knows: Person0!
  source: Person0!
}

type Knows4 @relation(direction : OUT, from : "source", name : "KNOWS", to : "knows") {
  _id: ID!
  json: Object @dynamic(prefix : "prefix.")
  knows: Person4!
  source: Person4!
}

type Movie {
  id: ID!
  publishedBy: Publisher @relation(direction : OUT, from : "from", name : "PUBLISHED_BY", to : "to")
}

type Mutation {
}

type Person0 {
  name: String
}

type Person1 {
  name: String
}

type Person2 {
  age: [Int]
  name: String
}

type Person3 {
  name: String!
}

type Person4 {
  id: ID!
  name: String
}

type Person5 {
  id: ID!
  movies: [Movie] @relation(direction : OUT, from : "from", name : "LIKES", to : "to")
}

type Publisher {
  name: ID!
}

type Query {
  knows0(filter: _Knows0Filter, first: Int, id: ID, json: Object, offset: Int, orderBy: _Knows0Ordering): [Knows0!]!
  knows1(filter: _Knows1Filter, first: Int, id: ID, offset: Int, orderBy: _Knows1Ordering): [Knows1!]!
  knows4(_id: ID, filter: _Knows4Filter, first: Int, json: Object, offset: Int, orderBy: _Knows4Ordering): [Knows4!]!
  movie(filter: _MovieFilter, first: Int, id: ID, offset: Int, orderBy: _MovieOrdering): [Movie!]!
  person1(filter: _Person1Filter, first: Int, name: String, offset: Int, orderBy: _Person1Ordering): [Person1!]!
  person2(age: [Int], filter: _Person2Filter, first: Int, name: String, offset: Int, orderBy: _Person2Ordering): [Person2!]!
  person3(filter: _Person3Filter, first: Int, name: String, offset: Int, orderBy: _Person3Ordering): [Person3!]!
  person4(filter: _Person4Filter, first: Int, id: ID, name: String, offset: Int, orderBy: _Person4Ordering): [Person4!]!
  person5(filter: _Person5Filter, first: Int, id: ID, offset: Int, orderBy: _Person5Ordering): [Person5!]!
  publisher(filter: _PublisherFilter, first: Int, name: ID, offset: Int, orderBy: _PublisherOrdering): [Publisher!]!
}

enum _Knows0Ordering {
  id_asc
  id_desc
  json_asc
  json_desc
}

enum _Knows1Ordering {
  id_asc
  id_desc
}

enum _Knows4Ordering {
  _id_asc
  _id_desc
  json_asc
  json_desc
}

enum _MovieOrdering {
  id_asc
  id_desc
}

enum _Person1Ordering {
  name_asc
  name_desc
}

enum _Person2Ordering {
  age_asc
  age_desc
  name_asc
  name_desc
}

enum _Person3Ordering {
  name_asc
  name_desc
}

enum _Person4Ordering {
  id_asc
  id_desc
  name_asc
  name_desc
}

enum _Person5Ordering {
  id_asc
  id_desc
}

enum _PublisherOrdering {
  name_asc
  name_desc
}

input _Knows0Filter {
  AND: [_Knows0Filter!]
  NOT: [_Knows0Filter!]
  OR: [_Knows0Filter!]
  id: ID
  id_contains: ID
  id_ends_with: ID
  id_gt: ID
  id_gte: ID
  id_in: ID
  id_lt: ID
  id_lte: ID
  id_not: ID
  id_not_contains: ID
  id_not_ends_with: ID
  id_not_in: ID
  id_not_starts_with: ID
  id_starts_with: ID
  json: Object
  json_gt: Object
  json_gte: Object
  json_in: Object
  json_lt: Object
  json_lte: Object
  json_not: Object
  json_not_in: Object
}

input _Knows0Input {
  id: ID
  json: Object
}

input _Knows1Filter {
  AND: [_Knows1Filter!]
  NOT: [_Knows1Filter!]
  OR: [_Knows1Filter!]
  id: ID
  id_contains: ID
  id_ends_with: ID
  id_gt: ID
  id_gte: ID
  id_in: ID
  id_lt: ID
  id_lte: ID
  id_not: ID
  id_not_contains: ID
  id_not_ends_with: ID
  id_not_in: ID
  id_not_starts_with: ID
  id_starts_with: ID
}

input _Knows1Input {
  id: ID
}

input _Knows4Filter {
  AND: [_Knows4Filter!]
  NOT: [_Knows4Filter!]
  OR: [_Knows4Filter!]
  _id: ID
  _id_contains: ID
  _id_ends_with: ID
  _id_gt: ID
  _id_gte: ID
  _id_in: ID
  _id_lt: ID
  _id_lte: ID
  _id_not: ID
  _id_not_contains: ID
  _id_not_ends_with: ID
  _id_not_in: ID
  _id_not_starts_with: ID
  _id_starts_with: ID
  json: Object
  json_gt: Object
  json_gte: Object
  json_in: Object
  json_lt: Object
  json_lte: Object
  json_not: Object
  json_not_in: Object
}

input _Knows4Input {
  _id: ID
  json: Object
}

input _MovieFilter {
  AND: [_MovieFilter!]
  NOT: [_MovieFilter!]
  OR: [_MovieFilter!]
  id: ID
  id_contains: ID
  id_ends_with: ID
  id_gt: ID
  id_gte: ID
  id_in: ID
  id_lt: ID
  id_lte: ID
  id_not: ID
  id_not_contains: ID
  id_not_ends_with: ID
  id_not_in: ID
  id_not_starts_with: ID
  id_starts_with: ID
}

input _MovieInput {
  id: ID
}

input _Person1Filter {
  AND: [_Person1Filter!]
  NOT: [_Person1Filter!]
  OR: [_Person1Filter!]
  name: String
  name_contains: String
  name_ends_with: String
  name_gt: String
  name_gte: String
  name_in: String
  name_lt: String
  name_lte: String
  name_not: String
  name_not_contains: String
  name_not_ends_with: String
  name_not_in: String
  name_not_starts_with: String
  name_starts_with: String
}

input _Person1Input {
  name: String
}

input _Person2Filter {
  AND: [_Person2Filter!]
  NOT: [_Person2Filter!]
  OR: [_Person2Filter!]
  age: Int
  age_gt: Int
  age_gte: Int
  age_in: Int
  age_lt: Int
  age_lte: Int
  age_not: Int
  age_not_in: Int
  name: String
  name_contains: String
  name_ends_with: String
  name_gt: String
  name_gte: String
  name_in: String
  name_lt: String
  name_lte: String
  name_not: String
  name_not_contains: String
  name_not_ends_with: String
  name_not_in: String
  name_not_starts_with: String
  name_starts_with: String
}

input _Person2Input {
  age: [Int]
  name: String
}

input _Person3Filter {
  AND: [_Person3Filter!]
  NOT: [_Person3Filter!]
  OR: [_Person3Filter!]
  name: String
  name_contains: String
  name_ends_with: String
  name_gt: String
  name_gte: String
  name_in: String
  name_lt: String
  name_lte: String
  name_not: String
  name_not_contains: String
  name_not_ends_with: String
  name_not_in: String
  name_not_starts_with: String
  name_starts_with: String
}

input _Person3Input {
  name: String
}

input _Person4Filter {
  AND: [_Person4Filter!]
  NOT: [_Person4Filter!]
  OR: [_Person4Filter!]
  id: ID
  id_contains: ID
  id_ends_with: ID
  id_gt: ID
  id_gte: ID
  id_in: ID
  id_lt: ID
  id_lte: ID
  id_not: ID
  id_not_contains: ID
  id_not_ends_with: ID
  id_not_in: ID
  id_not_starts_with: ID
  id_starts_with: ID
  name: String
  name_contains: String
  name_ends_with: String
  name_gt: String
  name_gte: String
  name_in: String
  name_lt: String
  name_lte: String
  name_not: String
  name_not_contains: String
  name_not_ends_with: String
  name_not_in: String
  name_not_starts_with: String
  name_starts_with: String
}

input _Person4Input {
  id: ID
  name: String
}

input _Person5Filter {
  AND: [_Person5Filter!]
  NOT: [_Person5Filter!]
  OR: [_Person5Filter!]
  id: ID
  id_contains: ID
  id_ends_with: ID
  id_gt: ID
  id_gte: ID
  id_in: ID
  id_lt: ID
  id_lte: ID
  id_not: ID
  id_not_contains: ID
  id_not_ends_with: ID
  id_not_in: ID
  id_not_starts_with: ID
  id_starts_with: ID
}

input _Person5Input {
  id: ID
}

input _PublisherFilter {
  AND: [_PublisherFilter!]
  NOT: [_PublisherFilter!]
  OR: [_PublisherFilter!]
  name: ID
  name_contains: ID
  name_ends_with: ID
  name_gt: ID
  name_gte: ID
  name_in: ID
  name_lt: ID
  name_lte: ID
  name_not: ID
  name_not_contains: ID
  name_not_ends_with: ID
  name_not_in: ID
  name_not_starts_with: ID
  name_starts_with: ID
}

input _PublisherInput {
  name: ID
}

enum RelationDirection {
  IN
  OUT
  BOTH
}

directive @relation(name:String, direction: RelationDirection = OUT, from: String = "from", to: String = "to") on FIELD_DEFINITION | OBJECT
directive @cypher(statement:String) on FIELD_DEFINITION
directive @property(name:String) on FIELD_DEFINITION
directive @dynamic(prefix:String = "properties.") on FIELD_DEFINITION
scalar Object
----


=== Filter on Relation Mutations

.Configuration
[source,json]
----
{
  "query": {
    "enabled": false
  },
  "mutation": {
    "enabled": true,
    "exclude": [
      "Person0",
      "Person1",
      "Person2",
      "Person3",
      "Person4"
    ]
  }
}
----

.Augmented Schema
[source,graphql]
----
schema {
  query: Query
  mutation: Mutation
}

type Knows0 @relation(direction : OUT, from : "source", name : "KNOWS", to : "knows") {
  id: ID!
  json: Object @dynamic(prefix : "prefix.")
  knows: Person0!
  source: Person0!
}

type Knows1 @relation(direction : OUT, from : "source", name : "KNOWS", to : "knows") {
  id: ID!
  knows: Person0!
  source: Person0!
}

type Knows4 @relation(direction : OUT, from : "source", name : "KNOWS", to : "knows") {
  _id: ID!
  json: Object @dynamic(prefix : "prefix.")
  knows: Person4!
  source: Person4!
}

type Movie {
  id: ID!
  publishedBy: Publisher @relation(direction : OUT, from : "from", name : "PUBLISHED_BY", to : "to")
}

type Mutation {
  deleteKnows0(id: ID!): ID
  mergeKnows0(id: ID!, json: Object): Knows0!
  updateKnows0(id: ID!, json: Object): Knows0!

  deleteKnows1(id: ID!): ID

  createKnows4(json: Object, knows_id: ID!, source_id: ID!): Knows4!
  deleteKnows4(_id: ID!): ID
  mergeKnows4(_id: ID!, json: Object): Knows4!
  updateKnows4(_id: ID!, json: Object): Knows4!

  createMovie(id: ID!): Movie!
  deleteMovie(id: ID!): ID

  addMoviePublishedBy(id: ID!, publishedBy: ID!): Movie!
  deleteMoviePublishedBy(id: ID!, publishedBy: ID!): Movie!

  createPerson5(id: ID!): Person5!
  deletePerson5(id: ID!): ID

  addPerson5Movies(id: ID!, movies: [ID!]!): Person5!
  deletePerson5Movies(id: ID!, movies: [ID!]!): Person5!

  createPublisher(name: ID!): Publisher!
  deletePublisher(name: ID!): ID
}

type Person0 {
  name: String
}

type Person1 {
  name: String
}

type Person2 {
  age: [Int]
  name: String
}

type Person3 {
  name: String!
}

type Person4 {
  id: ID!
  name: String
}

type Person5 {
  id: ID!
  movies: [Movie] @relation(direction : OUT, from : "from", name : "LIKES", to : "to")
}

type Publisher {
  name: ID!
}

type Query {
}

enum RelationDirection {
  IN
  OUT
  BOTH
}

directive @relation(name:String, direction: RelationDirection = OUT, from: String = "from", to: String = "to") on FIELD_DEFINITION | OBJECT
directive @cypher(statement:String) on FIELD_DEFINITION
directive @property(name:String) on FIELD_DEFINITION
directive @dynamic(prefix:String = "properties.") on FIELD_DEFINITION
scalar Object

----